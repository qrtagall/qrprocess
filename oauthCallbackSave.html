<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üîÑ Saving Artifact...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      text-align: center;
      padding-top: 80px;
      color: #333;
    }
    .spinner {
      margin-top: 20px;
      font-size: 22px;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0% { opacity: 0.2; }
      50% { opacity: 1; }
      100% { opacity: 0.2; }
    }
    .info {
      font-size: 14px;
      color: #777;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>üîê Saving Artifact (v-1)</h2>
  <p class="info" id="status">Just a moment while we save your artifact...</p>
  <div class="spinner">‚è≥</div>

<script>

 (async function() {
  try {
    const params = new URLSearchParams(window.location.hash.substring(1));
    const rawState = params.get("state");
    
    let saveUrl = "";
    let id = "";
    
    try {
      const parsedState = JSON.parse(decodeURIComponent(rawState));
      saveUrl = parsedState.saveUrl || "";
      id = parsedState.id || "";
    } catch (e) {
      console.error("Failed to parse state:", e);
    }
    
    if (!saveUrl || !id) {
      document.getElementById("status").textContent = "‚ùå Missing save URL or ID.";
      return;
    }

    console.log("‚úÖ Redirecting to Save URL:", saveUrl);

    // ‚úÖ Instead of fetch(), just REDIRECT to saveUrl (Apps Script page)
   // window.location.href = saveUrl;


  /*
    // ‚úÖ SetTimeout after 8-10 seconds, trigger second OAuth escape
    setTimeout(() => {
      const finalRedirectUrl = `https://process.qrtagall.com/?id=${encodeURIComponent(id)}`;
      
      const secondOAuthUrl = `https://accounts.google.com/o/oauth2/v2/auth` +
        `?response_type=token` +
        `&client_id=121290253918-e3qk9a1qao4r4r89s52lcq79evcbbes2.apps.googleusercontent.com` +
        `&redirect_uri=${encodeURIComponent('https://process.qrtagall.com/oauth-redirect-final.html')}` +
        `&scope=${encodeURIComponent('https://www.googleapis.com/auth/userinfo.email')}` +
        `&state=${encodeURIComponent(finalRedirectUrl)}`;

      console.log("üîÅ Triggering Second OAuth Escape:", secondOAuthUrl);
      window.location.href = secondOAuthUrl;
    }, 10000);

    */

  } catch (error) {
    console.error("Critical Error:", error);
    document.getElementById("status").textContent = "‚ùå Unexpected error occurred.";
    window.location.href = "https://process.qrtagall.com";
  }
})();



</script>

</body>
</html>
