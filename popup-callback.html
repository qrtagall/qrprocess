<!DOCTYPE html>
<html>
<head>
  <title>QRTagAll - Claim Finalized</title>
<script>
  window.onload = function () {
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");
    const claimed = urlParams.get("claimed");

    console.log("üßæ ID parsed in popup:", id);
    console.log("üîç opener exists?", !!window.opener);

    if (window.opener && id && claimed === "1") {
      console.log("‚úÖ Posting message to parent");
      window.opener.postMessage({ claimed: true, id }, "*");
      setTimeout(() => window.close(), 400);
    } else {
      document.body.innerHTML = `
        <p style="padding:30px; font-family:sans-serif;">
          ‚ùå Cannot notify parent.<br>
          <code>opener</code>: ${window.opener ? 'ok' : 'null'}<br>
          <code>id</code>: ${id || 'missing'}<br>
          <code>claimed</code>: ${claimed || 'missing'}
        </p>`;
    }
  };
</script>


    // Optionally close this window after short delay
    setTimeout(() => window.close(), 1000);
  </script>
</head>
<body>
  <p>‚úÖ QR Claimed. You can close this window.</p>
  <script>
    // auto-close in 1 second, fallback after 3 seconds
    setTimeout(() => {
      try {
        window.close();
      } catch (e) {}
    }, 1000);
    setTimeout(() => {
      document.body.innerHTML += "<p style='font-size:12px; color:gray'>(If not closed, please close manually..)</p>";
    }, 3000);
  </script>
</body>

</html>
