<!DOCTYPE html>
<html>
<head>
  <title>QRTagAll - Claim Finalized</title>

  <script>
  // Extract ID from URL
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  const claimed = params.get("claimed");

  console.log("ðŸ§¾ ID parsed in popup:", id);

  if (id && claimed) {
    // âœ… 1. Broadcast via channel
    try {
      const channel = new BroadcastChannel("qr_claim_channel");
      channel.postMessage({ id, claimed: true });
      console.log("ðŸ“¡ Broadcast sent");
    } catch (e) {
      console.warn("âš ï¸ BroadcastChannel not supported:", e);
    }

    // âœ… 2. Fallback: postMessage to opener
    try {
      if (window.opener) {
        console.log("ðŸ“¤ Sending postMessage to parent");
        window.opener.postMessage({ id, claimed: true }, "*");
      }
    } catch (e) {
      console.warn("âš ï¸ postMessage failed:", e);
    }

    // âœ… 3. Set localStorage flag
    try {
      localStorage.setItem("qr_claimed", JSON.stringify({
        id,
        claimed: true,
        timestamp: new Date().toISOString()
      }));
    } catch (e) {
      console.warn("âš ï¸ localStorage sync failed:", e);
    }

    // âœ… 4. Auto-close after short delay
    setTimeout(() => {
      console.log("ðŸ”’ Closing popup...");
      window.close();
    }, 1000);
  }
</script>


  
</body>

</html>
